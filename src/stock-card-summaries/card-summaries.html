<h2 ng-show="vm.title">
  {{'stockCardSummaries.title' |
  message:{'facilityName': vm.title.facility, 'program': vm.title.program} }}
</h2>
<h2 ng-hide="vm.title">{{'stockCardSummaries.stockOnHand' | message}}</h2>

<div ng-if="vm.error" class="alert is-error" ng-show="vm.error">{{vm.error}}</div>

<section class="openlmis-table-container">
  <form ng-submit="vm.search()" openlmis-table-filter>
     <openlmis-facility-program-select
        is-supervised="vm.isSupervised"
        facility="vm.facility"
        program="vm.program"
        module="'stock-card-summaries'">
    </openlmis-facility-program-select>

    <fieldset>
      <label for="keyword">{{'stockCardSummaries.keyword' | message}}</label>
      <input id="keyword" type="text" ng-model="vm.keyword" maxlength="50"/>
    </fieldset>

    <input type="submit" value="{{'stockCardSummaries.search'|message}}"/>
  </form>

  <button class="primary" ng-disabled="!vm.stockCardSummaries.length" ng-click="vm.print()">{{'stockCardSummaries.print' | message}}</button>

  <table>
    <caption ng-if="!vm.stockCardSummaries.length">
      {{'stockCardSummaries.noProducts' | message}}
    </caption>
    <thead>
    <tr>
      <th>{{'stockCardSummaries.productCode' | message}}</th>
      <th>{{'stockCardSummaries.product' | message}}</th>
      <th ng-show="vm.hasLot">{{'stockCardSummaries.lotCode' | message}}</th>
      <th ng-show="vm.hasLot">{{'stockCardSummaries.expiryDate' | message}}</th>
      <th>{{'stockCardSummaries.lastUpdate' | message}}</th>
      <th>{{'stockCardSummaries.stockOnHand' | message}}</th>
      <th>{{'stockCardSummaries.actions' | message}}</th>
    </tr>
    </thead>
    <tbody>
    <tr ng-if="summaries.length > 1" ng-repeat-start="summaries in vm.pagedSummaries">
      <td>{{summaries[0].orderable.productCode}}</td>
      <td>{{summaries[0].orderable | productName}}</td>
      <td></td>
      <td></td>
      <td></td>
      <td align="right">{{vm.calculateSOH(summaries)}}</td>
      <td></td>
    </tr>
    <tr ng-repeat="summary in summaries | orderBy:'lot?lot.lotCode:\'\''" ng-repeat-end>
      <td>{{summaries.length > 1 ? '' : summary.orderable.productCode}}</td>
      <td>{{summaries.length > 1 ? '' : (summary.orderable | productName)}}</td>
      <td ng-show="vm.hasLot">{{summary.lot ? summary.lot.lotCode : vm.determineLotMessage(summary)}}
      </td>
      <td ng-show="vm.hasLot">{{summary.lot.expirationDate | openlmisDate}}</td>
      <td>{{summary.lastUpdate | openlmisDate}}</td>
      <td align="right">{{summary.stockOnHand}}</td>
      <td>
        <button type="button" ng-click="vm.viewSingleCard(summary.id)" class="primary">
          {{'stockCardSummaries.view'| message}}
        </button>
      </td>
    </tr>
    </tbody>
  </table>
  <openlmis-pagination list="vm.stockCardSummaries" paged-list="vm.pagedSummaries"></openlmis-pagination>
</section>
